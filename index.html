<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournoi de Football - CPGE Errachidia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            color: #2a5298;
        }

        .tab.active {
            color: #2a5298;
            border-bottom-color: #2a5298;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .classement-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .classement-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .classement-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .classement-table tr:hover {
            background: #f5f5f5;
        }

        .position {
            font-weight: bold;
            font-size: 1.2em;
            color: #2a5298;
        }

        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .match-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .match-header {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }

        .team {
            flex: 1;
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
        }

        .score {
            font-size: 2em;
            font-weight: bold;
            color: #2a5298;
            padding: 0 20px;
        }

        .vs {
            font-size: 1.5em;
            color: #999;
            padding: 0 20px;
        }

        .match-status {
            text-align: center;
            margin-top: 10px;
            padding: 8px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .status-termine {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-prevu {
            background: #fff3e0;
            color: #ef6c00;
        }

        .week-section {
            margin-bottom: 40px;
        }

        .week-title {
            font-size: 1.5em;
            color: #2a5298;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .add-result-form {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-left: 10px;
        }

        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .loading-message {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öΩ Tournoi de Football</h1>
            <p>Centre CPGE Errachidia - Saison 2024/2025</p>
        </header>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('classement')">Classement</button>
                <button class="tab" onclick="showTab('calendrier')">Calendrier</button>
                <button class="tab" onclick="showTab('resultats')">R√©sultats</button>
                <button class="tab" onclick="showTab('gestion')">Gestion</button>
            </div>

            <div id="classement" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalMatches">0</div>
                        <div class="stat-label">Matchs Jou√©s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalButs">0</div>
                        <div class="stat-label">Buts Marqu√©s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">7</div>
                        <div class="stat-label">√âquipes</div>
                    </div>
                </div>

                <table class="classement-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>√âquipe</th>
                            <th>MJ</th>
                            <th>V</th>
                            <th>N</th>
                            <th>D</th>
                            <th>BP</th>
                            <th>BC</th>
                            <th>Diff</th>
                            <th>Pts</th>
                        </tr>
                    </thead>
                    <tbody id="classementBody"></tbody>
                </table>
            </div>

            <div id="calendrier" class="tab-content">
                <div id="calendrierContent"></div>
            </div>

            <div id="resultats" class="tab-content">
                <div id="resultatsContent"></div>
            </div>

            <div id="gestion" class="tab-content">
                <div id="successMessage" class="success-message">‚úì R√©sultat enregistr√© avec succ√®s !</div>
                
                <div class="add-result-form">
                    <h2 style="margin-bottom: 20px; color: #2a5298;">Ajouter un r√©sultat</h2>
                    <div class="form-group">
                        <label>Semaine</label>
                        <select id="semaine"></select>
                    </div>
                    <div class="form-group">
                        <label>Match</label>
                        <select id="matchSelect"></select>
                    </div>
                    <div class="form-group">
                        <label>Score √âquipe 1</label>
                        <input type="number" id="score1" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Score √âquipe 2</label>
                        <input type="number" id="score2" min="0" value="0">
                    </div>
                    <div class="action-buttons">
                        <button class="btn" onclick="ajouterResultat()">Enregistrer le r√©sultat</button>
                        <button class="btn btn-danger" onclick="reinitialiserTournoi()">R√©initialiser tout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const equipes = [
            "√âquipe Alpha",
            "√âquipe Beta",
            "√âquipe Gamma",
            "√âquipe Delta",
            "√âquipe Epsilon",
            "√âquipe Zeta",
            "√âquipe Eta"
        ];

        let stats = {};
        let calendrier = [];

        function initialiserCalendrier() {
            return [
                { semaine: 1, matches: [
                    {equipe1: "√âquipe Alpha", equipe2: "√âquipe Beta", score1: null, score2: null},
                    {equipe1: "√âquipe Gamma", equipe2: "√âquipe Delta", score1: null, score2: null},
                    {equipe1: "√âquipe Epsilon", equipe2: "√âquipe Zeta", score1: null, score2: null}
                ]},
                { semaine: 2, matches: [
                    {equipe1: "√âquipe Eta", equipe2: "√âquipe Alpha", score1: null, score2: null},
                    {equipe1: "√âquipe Beta", equipe2: "√âquipe Gamma", score1: null, score2: null},
                    {equipe1: "√âquipe Delta", equipe2: "√âquipe Epsilon", score1: null, score2: null}
                ]},
                { semaine: 3, matches: [
                    {equipe1: "√âquipe Zeta", equipe2: "√âquipe Beta", score1: null, score2: null},
                    {equipe1: "√âquipe Alpha", equipe2: "√âquipe Gamma", score1: null, score2: null},
                    {equipe1: "√âquipe Eta", equipe2: "√âquipe Delta", score1: null, score2: null}
                ]},
                { semaine: 4, matches: [
                    {equipe1: "√âquipe Epsilon", equipe2: "√âquipe Alpha", score1: null, score2: null},
                    {equipe1: "√âquipe Gamma", equipe2: "√âquipe Zeta", score1: null, score2: null},
                    {equipe1: "√âquipe Beta", equipe2: "√âquipe Eta", score1: null, score2: null}
                ]},
                { semaine: 5, matches: [
                    {equipe1: "√âquipe Delta", equipe2: "√âquipe Alpha", score1: null, score2: null},
                    {equipe1: "√âquipe Epsilon", equipe2: "√âquipe Gamma", score1: null, score2: null},
                    {equipe1: "√âquipe Zeta", equipe2: "√âquipe Eta", score1: null, score2: null}
                ]},
                { semaine: 6, matches: [
                    {equipe1: "√âquipe Alpha", equipe2: "√âquipe Zeta", score1: null, score2: null},
                    {equipe1: "√âquipe Beta", equipe2: "√âquipe Delta", score1: null, score2: null},
                    {equipe1: "√âquipe Gamma", equipe2: "√âquipe Eta", score1: null, score2: null}
                ]},
                { semaine: 7, matches: [
                    {equipe1: "√âquipe Epsilon", equipe2: "√âquipe Beta", score1: null, score2: null},
                    {equipe1: "√âquipe Delta", equipe2: "√âquipe Gamma", score1: null, score2: null},
                    {equipe1: "√âquipe Eta", equipe2: "√âquipe Epsilon", score1: null, score2: null}
                ]}
            ];
        }

        async function sauvegarderDonnees() {
            try {
                await window.storage.set('calendrier_tournoi', JSON.stringify(calendrier), false);
                console.log('‚úì Donn√©es sauvegard√©es avec succ√®s');
            } catch (error) {
                console.error('‚úó Erreur lors de la sauvegarde:', error);
            }
        }

        async function chargerDonnees() {
            try {
                const result = await window.storage.get('calendrier_tournoi', false);
                if (result && result.value) {
                    calendrier = JSON.parse(result.value);
                    console.log('‚úì Donn√©es charg√©es avec succ√®s');
                    return true;
                } else {
                    console.log('‚Ñπ Aucune donn√©e trouv√©e, initialisation du calendrier');
                    calendrier = initialiserCalendrier();
                    await sauvegarderDonnees();
                    return true;
                }
            } catch (error) {
                console.log('‚Ñπ Premi√®re utilisation, initialisation du calendrier');
                calendrier = initialiserCalendrier();
                await sauvegarderDonnees();
                return true;
            }
        }

        function calculerStats() {
            equipes.forEach(e => {
                stats[e] = {
                    matchesJoues: 0,
                    victoires: 0,
                    nuls: 0,
                    defaites: 0,
                    butsMarques: 0,
                    butsEncaisses: 0,
                    points: 0
                };
            });

            calendrier.forEach(sem => {
                sem.matches.forEach(m => {
                    if (m.score1 !== null && m.score2 !== null) {
                        stats[m.equipe1].matchesJoues++;
                        stats[m.equipe2].matchesJoues++;
                        stats[m.equipe1].butsMarques += m.score1;
                        stats[m.equipe1].butsEncaisses += m.score2;
                        stats[m.equipe2].butsMarques += m.score2;
                        stats[m.equipe2].butsEncaisses += m.score1;

                        if (m.score1 > m.score2) {
                            stats[m.equipe1].victoires++;
                            stats[m.equipe1].points += 3;
                            stats[m.equipe2].defaites++;
                        } else if (m.score2 > m.score1) {
                            stats[m.equipe2].victoires++;
                            stats[m.equipe2].points += 3;
                            stats[m.equipe1].defaites++;
                        } else {
                            stats[m.equipe1].nuls++;
                            stats[m.equipe2].nuls++;
                            stats[m.equipe1].points++;
                            stats[m.equipe2].points++;
                        }
                    }
                });
            });
        }

        function afficherClassement() {
            calculerStats();
            const tbody = document.getElementById('classementBody');
            const classement = equipes.map(e => ({nom: e, ...stats[e]}))
                .sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    const diffA = a.butsMarques - a.butsEncaisses;
                    const diffB = b.butsMarques - b.butsEncaisses;
                    if (diffB !== diffA) return diffB - diffA;
                    return b.butsMarques - a.butsMarques;
                });

            tbody.innerHTML = classement.map((e, i) => `
                <tr>
                    <td><span class="position">${i+1}</span></td>
                    <td><strong>${e.nom}</strong></td>
                    <td>${e.matchesJoues}</td>
                    <td>${e.victoires}</td>
                    <td>${e.nuls}</td>
                    <td>${e.defaites}</td>
                    <td>${e.butsMarques}</td>
                    <td>${e.butsEncaisses}</td>
                    <td>${e.butsMarques - e.butsEncaisses}</td>
                    <td><strong>${e.points}</strong></td>
                </tr>
            `).join('');

            const totalMatches = classement.reduce((s, e) => s + e.matchesJoues, 0) / 2;
            const totalButs = classement.reduce((s, e) => s + e.butsMarques, 0);
            document.getElementById('totalMatches').textContent = totalMatches;
            document.getElementById('totalButs').textContent = totalButs;
        }

        function afficherCalendrier() {
            const content = document.getElementById('calendrierContent');
            content.innerHTML = calendrier.map(sem => `
                <div class="week-section">
                    <div class="week-title">Semaine ${sem.semaine}</div>
                    <div class="matches-grid">
                        ${sem.matches.map(m => `
                            <div class="match-card">
                                <div class="match-header">Match ${sem.semaine}</div>
                                <div class="match-teams">
                                    <div class="team">${m.equipe1}</div>
                                    <div class="${m.score1 !== null ? 'score' : 'vs'}">
                                        ${m.score1 !== null ? `${m.score1} - ${m.score2}` : 'VS'}
                                    </div>
                                    <div class="team">${m.equipe2}</div>
                                </div>
                                <div class="match-status ${m.score1 !== null ? 'status-termine' : 'status-prevu'}">
                                    ${m.score1 !== null ? '‚úì Termin√©' : '‚è± √Ä venir'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function afficherResultats() {
            const content = document.getElementById('resultatsContent');
            const matchsJoues = [];
            calendrier.forEach(sem => {
                sem.matches.forEach(m => {
                    if (m.score1 !== null) {
                        matchsJoues.push({...m, semaine: sem.semaine});
                    }
                });
            });

            if (matchsJoues.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Aucun r√©sultat enregistr√© pour le moment.</p>';
                return;
            }

            content.innerHTML = `
                <div class="matches-grid">
                    ${matchsJoues.map(m => `
                        <div class="match-card">
                            <div class="match-header">Semaine ${m.semaine}</div>
                            <div class="match-teams">
                                <div class="team">${m.equipe1}</div>
                                <div class="score">${m.score1} - ${m.score2}</div>
                                <div class="team">${m.equipe2}</div>
                            </div>
                            <div class="match-status status-termine">‚úì Termin√©</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function initialiserGestion() {
            const semaineSelect = document.getElementById('semaine');
            semaineSelect.innerHTML = calendrier.map(s => 
                `<option value="${s.semaine}">Semaine ${s.semaine}</option>`
            ).join('');
            semaineSelect.addEventListener('change', chargerMatchs);
            chargerMatchs();
        }

        function chargerMatchs() {
            const semaine = parseInt(document.getElementById('semaine').value);
            const matchSelect = document.getElementById('matchSelect');
            const sem = calendrier.find(s => s.semaine === semaine);
            
            matchSelect.innerHTML = sem.matches.map((m, i) => 
                `<option value="${i}">${m.equipe1} vs ${m.equipe2}${m.score1 !== null ? ' (' + m.score1 + '-' + m.score2 + ')' : ''}</option>`
            ).join('');
        }

        async function ajouterResultat() {
            const semaine = parseInt(document.getElementById('semaine').value);
            const matchIndex = parseInt(document.getElementById('matchSelect').value);
            const score1 = parseInt(document.getElementById('score1').value);
            const score2 = parseInt(document.getElementById('score2').value);

            const sem = calendrier.find(s => s.semaine === semaine);
            sem.matches[matchIndex].score1 = score1;
            sem.matches[matchIndex].score2 = score2;

            await sauvegarderDonnees();

            const successMsg = document.getElementById('successMessage');
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);

            afficherClassement();
            afficherCalendrier();
            afficherResultats();
            chargerMatchs();
        }

        async function reinitialiserTournoi() {
            if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser tous les r√©sultats ? Cette action est irr√©versible.')) {
                calendrier = initialiserCalendrier();
                await sauvegarderDonnees();
                
                afficherClassement();
                afficherCalendrier();
                afficherResultats();
                initialiserGestion();
                
                alert('Le tournoi a √©t√© r√©initialis√© avec succ√®s !');
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'classement') afficherClassement();
            if (tabName === 'calendrier') afficherCalendrier();
            if (tabName === 'resultats') afficherResultats();
        }

        async function init() {
            console.log('üèÅ Initialisation du tournoi...');
            await chargerDonnees();
            afficherClassement();
            afficherCalendrier();
            afficherResultats();
            initialiserGestion();
            console.log('‚úì Tournoi initialis√© avec succ√®s');
        }

        init();
    </script>
</body>
</html>